{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/study/javascript/core-javascript-group-study-draft/blob/","result":{"data":{"site":{"siteMetadata":{"title":"{ 모리 막장저장소 }","author":"kwonmory","siteUrl":"https://blog.kwonmory.com","comment":{"disqusShortName":"","utterances":"kwonmory/kwonmory.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"0277046c-a4cc-56b2-ab3b-ffdf8a2fb018","excerpt":"시작하기 ArrayBuffer 랑 views는 ECMA 표준의 일부분이다. 바이너리 데이터는 비표준으로 구현했다고 했던거 같은데.. 이를 표준으로 바꾼게 ArrayBuffer와 views인 것 같다. Blob은 type과 blobParts로 구성되어있고, type은 문자열로 되어있다. MIME 타입으로 주로 되어있다. blobParts는 Blobs 객체, 문자열, BufferSource 등으로 연속적으로 이루어져있다. blobParts : Blob, BufferSource, String…","html":"<h1 id=\"시작하기\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\" aria-label=\"시작하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시작하기</h1>\n<p>ArrayBuffer 랑 views는 ECMA 표준의 일부분이다.</p>\n<blockquote>\n<p>바이너리 데이터는 비표준으로 구현했다고 했던거 같은데..</p>\n<p>이를 표준으로 바꾼게 ArrayBuffer와 views인 것 같다.</p>\n</blockquote>\n<p>Blob은 type과 blobParts로 구성되어있고,</p>\n<p>type은 문자열로 되어있다. MIME 타입으로 주로 되어있다.</p>\n<p>blobParts는 Blobs 객체, 문자열, BufferSource 등으로 연속적으로 이루어져있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span>blobParts<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>blobParts : Blob, BufferSource, String 값으로 구성</li>\n<li>\n<p>options</p>\n<ul>\n<li>type : Blob 타입이 무엇인지, 예로 image/png 같은 것들</li>\n<li>endings : 줄 바꿈에 해당하도록 줄 끝을 변환 여부 옵션(transparent(기본값) : 아무것도 안함, native : 변환함)</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;div>...&lt;/div>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'text/html'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> hello <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">108</span><span class=\"token punctuation\">,</span> <span class=\"token number\">111</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> blob2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>hello<span class=\"token punctuation\">,</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>blob 메서드</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">blob<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>byteStart<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>byteEnd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>contentType<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Blob은 불변객체이다. 그래서 값을 직접적으로 바꾸진 못한다. 그래도 slice메서드를 통해서 새로운 Blob 객체를 만들 수 있다.</p>\n<h2 id=\"blob-as-url\" style=\"position:relative;\"><a href=\"#blob-as-url\" aria-label=\"blob as url permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Blob as URL</h2>\n<p>Blob은 콘텐츠를 표시하기 위해서 앵커 태그나 이미지 태그 등의 URL로 쉽게 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 코어 자바스크립트</span>\n<span class=\"token operator\">&lt;</span>a download<span class=\"token operator\">=</span><span class=\"token string\">\"hello.txt\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">'#'</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"link\"</span><span class=\"token operator\">></span>Download<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\n\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n<span class=\"token keyword\">let</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"Hello, world!\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>type<span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nlink<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>createObjectURL을 사용하게 되면, 유닉크한 URL이 만들어진다.</p>\n<p>주의할점이 있다. Blob 자체는 메모리에 있기 떄문에 브라우저가 메모리에서 Blob 데이터를 제거하지 못한다.</p>\n<p>그래서 직접적으로 제거할 수 있게 <code class=\"language-text\">URL.revokeObjectURL(url)</code>을 통해서 제거 해줘야한다.</p>\n<h2 id=\"blob-to-base64\" style=\"position:relative;\"><a href=\"#blob-to-base64\" aria-label=\"blob to base64 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Blob to base64</h2>\n<p>URL로 만들지 않고 문자열로도 만들 수 있다.</p>\n<p><code class=\"language-text\">data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code> 의 형태를 가지게 된다.</p>\n<p>Blob을 base64인코딩 문자열로 바꿔보자</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"Hi\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>type<span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nreader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nreader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQoz5VSW27DMAzzVeK3HdtxgzVOinZFC2z3vxEnGd2rWIHugxATyTQZRQTjkesLplxwbA2ntscuRxSrMAeLYC30MMBI+RREiCMOh4atRaytYjfPkEp3DEpBEbTWUHfQD7jw3mMmkTol1FrhyJGUQxdiyB/4fKfIiST0/h0Xzjm0tmJZGtWGnDL4ktE7JG+oWmSKzjWE0HsxRqSUfnHWiWOBYLvn45kEF2qMCD70oRhowJkOFubKAnyQhXnmm483PkKw1evpilcSnShyyvmr8mV/RZYPIvOnEPxwIcH3yxsKObRGIzgLb00X/C+EtQ7bstEvs+JM297XgkIRC0Xu27tt+Vl8AJ9L6r8m9zrCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"13cr11n133ot 2020 10 12 15 41 13\"\n        title=\"13cr11n133ot 2020 10 12 15 41 13\"\n        src=\"/static/a8f508c77ae4764c44f937476715cb10/c1b63/13cr11n133ot-2020-10-12-15-41-13.png\"\n        srcset=\"/static/a8f508c77ae4764c44f937476715cb10/5a46d/13cr11n133ot-2020-10-12-15-41-13.png 300w,\n/static/a8f508c77ae4764c44f937476715cb10/0a47e/13cr11n133ot-2020-10-12-15-41-13.png 600w,\n/static/a8f508c77ae4764c44f937476715cb10/c1b63/13cr11n133ot-2020-10-12-15-41-13.png 1200w,\n/static/a8f508c77ae4764c44f937476715cb10/10d53/13cr11n133ot-2020-10-12-15-41-13.png 1724w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>이렇게 크게 2가지 방법이 있는 걸 볼 수 있었다.</p>\n<p>URL(createObjectURL)을 만들거나 data url을 만들거나</p>\n<p>전자가 간단하고 빠르다고 한다.</p>\n<p>하지만, revoke를 해줘야한다는 점!</p>\n<p>후자 같은 경우에는 메모리상으로는 이슈가 없지만, 인코딩할 대 큰 blob 데이터 같은 경우에는 성능이나 메모리에 이슈가 있을 수 있다.</p>\n<h2 id=\"image-to-blob\" style=\"position:relative;\"><a href=\"#image-to-blob\" aria-label=\"image to blob permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image to blob</h2>\n<p>canvas를 이용해서 toBlob() 메서드를 이용하여 변환이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 코어 자바스크립트 소스</span>\n<span class=\"token comment\">// take any image</span>\n<span class=\"token keyword\">let</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// make &lt;canvas> of the same size</span>\n<span class=\"token keyword\">let</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>clientWidth<span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> context <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// copy image to it (this method allows to cut image)</span>\ncontext<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// we can context.rotate(), and do many other things on canvas</span>\n\n<span class=\"token comment\">// toBlob is async opereation, callback is called when done</span>\ncanvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">blob</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// blob ready, download it</span>\n  <span class=\"token keyword\">let</span> link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> <span class=\"token string\">'example.png'</span><span class=\"token punctuation\">;</span>\n\n  link<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  link<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// delete the internal blob reference, to let the browser clear memory from it</span>\n  <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'image/png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"GS - Blob","date":"10월 12일, 2020"}}},"pageContext":{"slug":"/study/javascript/core-javascript-group-study-draft/blob/","previous":{"fields":{"slug":"/study/javascript/core-javascript-group-study-draft/ArrayBuffer-binary-arrays/"},"frontmatter":{"title":"GS - ArrayBuffer, binary arrays","category":"gs-core-javascript","draft":false,"type":null}},"next":{"fields":{"slug":"/study/javascript/core-javascript-group-study-draft/file-and-file-reader/"},"frontmatter":{"title":"GS - File and FileReader","category":"gs-core-javascript","draft":false,"type":null}}}},"staticQueryHashes":["3128451518","911025623"]}